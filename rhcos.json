{

"variables": {
  "vcenter_server": "vcsa.gxr.me",
  "vcenter_username": "administrator@vsphere.local",
  "vcenter_password": "",
  "datacenter": "GXR",
  "cluster": "GXR-Primary",
  "host": "esx2.gxr.me",
  "datastore": "esx2_vms_nvme1",
  "path": "",
  "vcpu": "4",
  "memory": "16384",
  "rootdisksizegb":"61440",
  "network": "VM_vlan20",
  "v4address": "192.168.20.71",
  "v4defaultgw": "192.168.20.1",
  "v4netmask": "255.255.255.0",
  "nodename": "bootstrap",
  "domainname": "gxr.me",
  "clustername": "test",
  "type": "bootstrap"
},

  "builders": [
    {
      "type": "vsphere-iso",
      "vcenter_server": "{{user `vcenter_server`}}",
      "username": "{{user `vcenter_username`}}",
      "password": "{{user `vcenter_password`}}",
      "host": "{{ user `host`}}",
      "communicator": "ssh",
      "ssh_username": "core",
      "ssh_private_key_file": "~/.ssh/id_rsa",
      "shutdown_command": "sudo -S shutdown -P now",
      "insecure_connection": "true",
      "vm_name": "{{user `nodename`}}",
      "folder": "{{user `path`}}",
      "cluster": "{{user `cluster`}}",
      "datastore": "{{user `datastore`}}",
      "datacenter": "{{user `datacenter`}}",
      "network": "{{user `network`}}",
      "guest_os_type": "rhel7_64Guest",
      "CPUs": "{{user `vcpu`}}",
      "RAM": "{{user `memory`}}",
      "disk_controller_type": "pvscsi",
      "disk_size": "{{user `rootdisksizegb`}}",
      "disk_thin_provisioned": true,
      "vm_version": 13,
      "network_card": "vmxnet3",
      "iso_paths": [
        "[esx_WC_NFS] ISO/rhcos-4.3.8-x86_64-installer.x86_64.iso"
      ],
      "boot_order": "disk,cdrom",
      "convert_to_template": false,
      "boot_wait": "10s",
      "boot_command": [
        "<tab>",
        " ip={{user `v4address`}}::{{user `v4defaultgw`}}:{{user `v4netmask`}}:{{user `nodename`}}.{{user `domainname`}}:ens192:none nameserver=192.168.1.1 coreos.inst.install_dev=sda coreos.inst.image_url=http://192.168.1.55:88/coreos/rhcos-4.3.8-x86_64-metal.x86_64.raw.gz coreos.inst.ignition_url=http://192.168.1.55:88/ignition/{{user `clustername`}}/{{user `type`}}.ign",
        "<wait>",
        "<enter>",
        "<wait>"
      ]
    }
  ]
}
